<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milwaukee Vehicle Finder - Find Your Perfect Car</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            opacity: 0.9;
        }

        /* Glassmorphism Search Panel */
        .search-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .form-control option {
            background: #1e293b;
            color: #fff;
        }

        .form-control::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Search Button */
        .btn-search {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        .btn-search:active {
            transform: translateY(0);
        }

        .btn-search:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Loading Spinner */
        .loading {
            text-align: center;
            padding: 4rem 2rem;
        }

        .spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Stats */
        .results-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }

        .stat-item {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            flex: 1;
            min-width: 200px;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
            margin-bottom: 0.5rem;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
        }

        /* Vehicle Grid */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        .vehicle-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .vehicle-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            border-color: var(--primary);
        }

        .vehicle-image {
            height: 180px;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            position: relative;
        }

        .vehicle-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--success);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            font-weight: 700;
            font-size: 1.125rem;
        }

        .vehicle-info {
            padding: 1.5rem;
        }

        .vehicle-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.75rem;
        }

        .vehicle-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 0.75rem;
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .vehicle-source {
            display: inline-block;
            background: rgba(255, 255, 255, 0.1);
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            text-transform: uppercase;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-content {
            background: var(--glass-bg);
            backdrop-filter: blur(40px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            width: 40px;
            height: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: rotate(90deg);
        }

        .modal-image {
            height: 300px;
            background: rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-title {
            font-size: 1.75rem;
            font-weight: 700;
            margin-bottom: 1rem;
        }

        .modal-price {
            font-size: 2rem;
            font-weight: 800;
            color: var(--success);
            margin-bottom: 2rem;
        }

        .modal-meta {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .modal-meta-item {
            background: rgba(255, 255, 255, 0.05);
            padding: 1rem;
            border-radius: 12px;
        }

        .modal-meta-label {
            font-size: 0.875rem;
            opacity: 0.7;
            margin-bottom: 0.5rem;
        }

        .modal-meta-value {
            font-size: 1.125rem;
            font-weight: 600;
        }

        .btn-view-listing {
            width: 100%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 1rem 2rem;
            font-size: 1.125rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-view-listing:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-results-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .no-results-subtext {
            opacity: 0.7;
        }

        /* Debug Console */
        .debug-toggle {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, #f59e0b 0%, #ef4444 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            font-size: 1.5rem;
            z-index: 999;
            transition: all 0.3s ease;
        }

        .debug-toggle:hover {
            transform: scale(1.1);
        }

        .debug-panel {
            position: fixed;
            bottom: 100px;
            right: 2rem;
            width: 400px;
            max-height: 600px;
            background: rgba(30, 41, 59, 0.98);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            z-index: 998;
            display: flex;
            flex-direction: column;
        }

        .debug-header {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .debug-title {
            font-weight: 700;
            font-size: 1rem;
        }

        .debug-actions {
            display: flex;
            gap: 0.5rem;
        }

        .debug-btn {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            padding: 0.5rem 0.75rem;
            border-radius: 6px;
            color: white;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.2s ease;
        }

        .debug-btn:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .debug-content {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.75rem;
        }

        .debug-log {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid #10b981;
        }

        .debug-log.error {
            border-left-color: #ef4444;
        }

        .debug-log.warning {
            border-left-color: #f59e0b;
        }

        .debug-log-time {
            color: #94a3b8;
            font-size: 0.7rem;
            margin-bottom: 0.25rem;
        }

        .debug-log-message {
            color: #e2e8f0;
            word-wrap: break-word;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .vehicle-grid {
                grid-template-columns: 1fr;
            }

            .results-stats {
                flex-direction: column;
            }

            .debug-panel {
                width: calc(100% - 4rem);
                right: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container" x-data="vehicleSearch()">
        <!-- Hero Section -->
        <div class="hero">
            <h1>üöó Milwaukee Vehicle Finder</h1>
            <p>Find your perfect car in Milwaukee - Real-time listings from Craigslist & more</p>
        </div>

        <!-- Search Panel -->
        <div class="search-panel">
            <form @submit.prevent="search()" class="form-grid">
                <div class="form-group">
                    <label for="make">Make</label>
                    <select id="make" x-model="searchParams.make" @change="onMakeChange()" class="form-control">
                        <option value="">Any Make</option>
                        <option value="Honda">Honda</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Ford">Ford</option>
                        <option value="Chevrolet">Chevrolet</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Mazda">Mazda</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Kia">Kia</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="BMW">BMW</option>
                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                        <option value="Audi">Audi</option>
                        <option value="Jeep">Jeep</option>
                        <option value="GMC">GMC</option>
                        <option value="Dodge">Dodge</option>
                        <option value="Ram">Ram</option>
                        <option value="Tesla">Tesla</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="model">Model</label>
                    <select id="model" x-model="searchParams.model" class="form-control">
                        <option value="">Any Model</option>
                        <template x-for="model in availableModels" :key="model">
                            <option :value="model" x-text="model"></option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label for="min_year">Min Year</label>
                    <select id="min_year" x-model="searchParams.min_year" class="form-control">
                        <option value="">Any Year</option>
                        <template x-for="year in years" :key="year">
                            <option :value="year" x-text="year"></option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_year">Max Year</label>
                    <select id="max_year" x-model="searchParams.max_year" class="form-control">
                        <option value="">Any Year</option>
                        <template x-for="year in years" :key="year">
                            <option :value="year" x-text="year"></option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_price">Max Price</label>
                    <select id="max_price" x-model="searchParams.max_price" class="form-control">
                        <option value="5000">$5,000</option>
                        <option value="10000">$10,000</option>
                        <option value="15000">$15,000</option>
                        <option value="20000">$20,000</option>
                        <option value="25000">$25,000</option>
                        <option value="30000">$30,000</option>
                        <option value="40000">$40,000</option>
                        <option value="50000">$50,000</option>
                        <option value="100000">$100,000+</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_mileage">Max Mileage</label>
                    <select id="max_mileage" x-model="searchParams.max_mileage" class="form-control">
                        <option value="50000">50,000 mi</option>
                        <option value="75000">75,000 mi</option>
                        <option value="100000">100,000 mi</option>
                        <option value="150000">150,000 mi</option>
                        <option value="200000">200,000 mi</option>
                        <option value="999999">Any</option>
                    </select>
                </div>
            </form>

            <button @click="search()" :disabled="loading" class="btn-search">
                <span x-show="!loading">üîç Search Vehicles</span>
                <span x-show="loading">Searching...</span>
            </button>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="loading">
            <div class="spinner"></div>
            <p>Searching for vehicles...</p>
        </div>

        <!-- Results Stats -->
        <div x-show="!loading && results.length > 0" class="results-stats">
            <div class="stat-item">
                <div class="stat-label">Total Found</div>
                <div class="stat-value" x-text="results.length"></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Avg Price</div>
                <div class="stat-value" x-text="'$' + avgPrice.toLocaleString()"></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Best Deal</div>
                <div class="stat-value" x-text="'$' + (results[0]?.price || 0).toLocaleString()"></div>
            </div>
        </div>

        <!-- Vehicle Grid -->
        <div x-show="!loading && results.length > 0" class="vehicle-grid">
            <template x-for="vehicle in results" :key="vehicle.id">
                <div class="vehicle-card" @click="openModal(vehicle)">
                    <div class="vehicle-image">
                        <span style="opacity: 0.3;">üöó</span>
                        <div class="vehicle-badge" x-text="'$' + vehicle.price.toLocaleString()"></div>
                    </div>
                    <div class="vehicle-info">
                        <div class="vehicle-title" x-text="vehicle.title"></div>
                        <div class="vehicle-meta">
                            <div class="meta-item" x-show="vehicle.year">
                                <span>üìÖ</span>
                                <span x-text="vehicle.year"></span>
                            </div>
                            <div class="meta-item" x-show="vehicle.mileage">
                                <span>üõ£Ô∏è</span>
                                <span x-text="vehicle.mileage.toLocaleString() + ' mi'"></span>
                            </div>
                        </div>
                        <span class="vehicle-source" x-text="vehicle.source"></span>
                    </div>
                </div>
            </template>
        </div>

        <!-- No Results -->
        <div x-show="!loading && searched && results.length === 0" class="no-results">
            <div class="no-results-icon">üîç</div>
            <div class="no-results-text">No vehicles found</div>
            <div class="no-results-subtext">Try adjusting your search criteria</div>
        </div>

        <!-- Modal -->
        <div x-show="selectedVehicle" 
             @click.self="closeModal()" 
             class="modal-overlay"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0">
            <div class="modal-content">
                <div class="modal-close" @click="closeModal()">‚úï</div>
                
                <div class="modal-image">
                    <span style="opacity: 0.3; font-size: 6rem;">üöó</span>
                </div>
                
                <div class="modal-body">
                    <h2 class="modal-title" x-text="selectedVehicle?.title"></h2>
                    <div class="modal-price" x-text="'$' + (selectedVehicle?.price || 0).toLocaleString()"></div>
                    
                    <div class="modal-meta">
                        <div class="modal-meta-item" x-show="selectedVehicle?.year">
                            <div class="modal-meta-label">Year</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.year"></div>
                        </div>
                        <div class="modal-meta-item" x-show="selectedVehicle?.mileage">
                            <div class="modal-meta-label">Mileage</div>
                            <div class="modal-meta-value" x-text="(selectedVehicle?.mileage || 0).toLocaleString() + ' mi'"></div>
                        </div>
                        <div class="modal-meta-item">
                            <div class="modal-meta-label">Source</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.source"></div>
                        </div>
                        <div class="modal-meta-item">
                            <div class="modal-meta-label">Location</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.location || 'Milwaukee'"></div>
                        </div>
                    </div>
                    
                    <button class="btn-view-listing" @click="window.open(selectedVehicle?.url, '_blank')">
                        View Full Listing ‚Üí
                    </button>
                </div>
            </div>
        </div>

        <!-- Debug Console Toggle -->
        <div class="debug-toggle" @click="debugOpen = !debugOpen">
            üêõ
        </div>

        <!-- Debug Panel -->
        <div x-show="debugOpen" class="debug-panel" x-transition>
            <div class="debug-header">
                <div class="debug-title">Debug Console</div>
                <div class="debug-actions">
                    <button class="debug-btn" @click="copyDebugLogs()">üìã Copy</button>
                    <button class="debug-btn" @click="downloadDebugLogs()">‚¨áÔ∏è Download</button>
                    <button class="debug-btn" @click="clearDebugLogs()">üóëÔ∏è Clear</button>
                </div>
            </div>
            <div class="debug-content">
                <template x-for="(log, index) in debugLogs" :key="index">
                    <div class="debug-log" :class="log.type">
                        <div class="debug-log-time" x-text="log.time"></div>
                        <div class="debug-log-message" x-text="log.message"></div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <script>
        function vehicleSearch() {
            return {
                loading: false,
                searched: false,
                results: [],
                selectedVehicle: null,
                debugOpen: false,
                debugLogs: [],
                searchParams: {
                    make: 'Honda',
                    model: 'Civic',
                    min_year: '',
                    max_year: '',
                    max_price: 20000,
                    max_mileage: 150000
                },
                years: [],
                availableModels: [],
                
                // Popular models by make
                modelsByMake: {
                    'Honda': ['Civic', 'Accord', 'CR-V', 'Pilot', 'Fit', 'Odyssey', 'HR-V', 'Ridgeline'],
                    'Toyota': ['Camry', 'Corolla', 'RAV4', 'Highlander', 'Tacoma', 'Tundra', '4Runner', 'Prius', 'Sienna'],
                    'Ford': ['F-150', 'Escape', 'Explorer', 'Edge', 'Mustang', 'Fusion', 'Focus', 'Ranger', 'Expedition'],
                    'Chevrolet': ['Silverado', 'Equinox', 'Malibu', 'Tahoe', 'Traverse', 'Colorado', 'Camaro', 'Suburban'],
                    'Nissan': ['Altima', 'Rogue', 'Sentra', 'Pathfinder', 'Frontier', 'Maxima', 'Murano', 'Versa'],
                    'Mazda': ['CX-5', 'Mazda3', 'CX-9', 'Mazda6', 'CX-30', 'MX-5 Miata'],
                    'Hyundai': ['Elantra', 'Sonata', 'Tucson', 'Santa Fe', 'Kona', 'Palisade', 'Accent'],
                    'Kia': ['Forte', 'Optima', 'Sorento', 'Soul', 'Sportage', 'Telluride', 'Rio'],
                    'Subaru': ['Outback', 'Forester', 'Crosstrek', 'Impreza', 'Legacy', 'Ascent', 'WRX'],
                    'Volkswagen': ['Jetta', 'Tiguan', 'Passat', 'Golf', 'Atlas', 'Beetle'],
                    'BMW': ['3 Series', '5 Series', 'X3', 'X5', '7 Series', 'X1', '4 Series'],
                    'Mercedes-Benz': ['C-Class', 'E-Class', 'GLC', 'GLE', 'S-Class', 'A-Class'],
                    'Audi': ['A4', 'Q5', 'A6', 'Q7', 'A3', 'Q3'],
                    'Jeep': ['Wrangler', 'Grand Cherokee', 'Cherokee', 'Compass', 'Renegade', 'Gladiator'],
                    'GMC': ['Sierra', 'Terrain', 'Acadia', 'Yukon', 'Canyon'],
                    'Dodge': ['Charger', 'Challenger', 'Durango', 'Grand Caravan'],
                    'Ram': ['1500', '2500', '3500', 'ProMaster'],
                    'Tesla': ['Model 3', 'Model Y', 'Model S', 'Model X']
                },

                init() {
                    this.log('info', 'Initializing Milwaukee Vehicle Finder');
                    
                    // Generate year options (current year down to 1990)
                    const currentYear = new Date().getFullYear();
                    for (let year = currentYear; year >= 1990; year--) {
                        this.years.push(year);
                    }
                    this.log('info', `Generated ${this.years.length} year options`);
                    
                    // Set initial models for Honda
                    this.onMakeChange();
                    
                    // Automatically search with default values on load
                    this.log('info', 'Starting automatic search with defaults: Honda Civic, $20k max, 150k miles max');
                    this.search();
                },

                onMakeChange() {
                    const make = this.searchParams.make;
                    this.log('info', `Make changed to: ${make || 'Any'}`);
                    
                    if (make && this.modelsByMake[make]) {
                        this.availableModels = this.modelsByMake[make];
                        this.log('info', `Loaded ${this.availableModels.length} models for ${make}`);
                        
                        // Reset model if current model is not available for new make
                        if (this.searchParams.model && !this.availableModels.includes(this.searchParams.model)) {
                            this.searchParams.model = '';
                            this.log('info', 'Reset model selection (not available for this make)');
                        }
                    } else {
                        this.availableModels = [];
                        this.searchParams.model = '';
                        this.log('info', 'Cleared model selection (Any Make selected)');
                    }
                },

                async search() {
                    this.loading = true;
                    this.searched = true;
                    this.results = [];
                    
                    const searchData = {
                        make: this.searchParams.make || undefined,
                        model: this.searchParams.model || undefined,
                        min_year: this.searchParams.min_year ? parseInt(this.searchParams.min_year) : undefined,
                        max_year: this.searchParams.max_year ? parseInt(this.searchParams.max_year) : undefined,
                        max_price: parseInt(this.searchParams.max_price),
                        max_mileage: parseInt(this.searchParams.max_mileage),
                        location: 'milwaukee'
                    };

                    this.log('info', `Starting search with params: ${JSON.stringify(searchData)}`);

                    try {
                        this.log('info', 'Sending POST request to /api/search');
                        
                        const response = await fetch('/api/search', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(searchData)
                        });

                        this.log('info', `Response status: ${response.status} ${response.statusText}`);
                        
                        const data = await response.json();
                        this.log('info', `Response data received: ${JSON.stringify(data).substring(0, 200)}...`);
                        
                        if (data.success && data.vehicles) {
                            this.results = data.vehicles;
                            this.log('success', `‚úì Search successful! Found ${this.results.length} vehicles`);
                            
                            if (this.results.length > 0) {
                                const avgPrice = this.avgPrice;
                                const minPrice = Math.min(...this.results.map(v => v.price));
                                const maxPrice = Math.max(...this.results.map(v => v.price));
                                this.log('info', `Price range: $${minPrice.toLocaleString()} - $${maxPrice.toLocaleString()} (avg: $${avgPrice.toLocaleString()})`);
                            }
                        } else {
                            this.log('error', `Search failed: ${data.error || 'Unknown error'}`);
                        }
                    } catch (error) {
                        this.log('error', `Search error: ${error.message}`);
                        console.error('Search error:', error);
                        alert('Search failed. Please try again.');
                    } finally {
                        this.loading = false;
                        this.log('info', 'Search completed');
                    }
                },

                log(type, message) {
                    const now = new Date();
                    const time = now.toLocaleTimeString('en-US', { hour12: false, hour: '2-digit', minute: '2-digit', second: '2-digit' });
                    
                    this.debugLogs.push({
                        type: type,
                        time: time,
                        message: message,
                        timestamp: now.getTime()
                    });

                    // Keep only last 100 logs
                    if (this.debugLogs.length > 100) {
                        this.debugLogs.shift();
                    }

                    // Also log to browser console
                    console.log(`[${time}] ${type.toUpperCase()}: ${message}`);
                },

                copyDebugLogs() {
                    const text = this.debugLogs.map(log => `[${log.time}] ${log.type.toUpperCase()}: ${log.message}`).join('\n');
                    navigator.clipboard.writeText(text).then(() => {
                        this.log('info', 'Debug logs copied to clipboard');
                        alert('Debug logs copied to clipboard!');
                    });
                },

                downloadDebugLogs() {
                    const text = this.debugLogs.map(log => `[${log.time}] ${log.type.toUpperCase()}: ${log.message}`).join('\n');
                    const blob = new Blob([text], { type: 'text/plain' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `debug-log-${Date.now()}.txt`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    this.log('info', 'Debug logs downloaded');
                },

                clearDebugLogs() {
                    this.debugLogs = [];
                    this.log('info', 'Debug logs cleared');
                },

                get avgPrice() {
                    if (this.results.length === 0) return 0;
                    const sum = this.results.reduce((acc, v) => acc + (v.price || 0), 0);
                    return Math.round(sum / this.results.length);
                },

                openModal(vehicle) {
                    this.selectedVehicle = vehicle;
                    document.body.style.overflow = 'hidden';
                    this.log('info', `Opened modal for: ${vehicle.title}`);
                },

                closeModal() {
                    this.selectedVehicle = null;
                    document.body.style.overflow = 'auto';
                    this.log('info', 'Closed modal');
                }
            }
        }
    </script>
</body>
</html>