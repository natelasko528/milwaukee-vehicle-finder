<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Milwaukee Vehicle Finder - Find Your Perfect Car</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #2563eb;
            --primary-dark: #1e40af;
            --secondary: #8b5cf6;
            --success: #10b981;
            --danger: #ef4444;
            --dark: #1e293b;
            --light: #f8fafc;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #fff;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        /* Hero Section */
        .hero {
            text-align: center;
            margin-bottom: 3rem;
            padding: 2rem 0;
        }

        .hero h1 {
            font-size: 3rem;
            font-weight: 800;
            margin-bottom: 1rem;
            background: linear-gradient(to right, #fff, #e0e7ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.25rem;
            opacity: 0.9;
        }

        /* Glassmorphism Search Panel */
        .search-panel {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
            padding: 2rem;
            margin-bottom: 3rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-size: 0.875rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            opacity: 0.9;
        }

        .form-control {
            background: rgba(255, 255, 255, 0.15);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 0.75rem 1rem;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.4);
            box-shadow: 0 0 0 3px rgba(255, 255, 255, 0.1);
        }

        .form-control option {
            background: #1e293b;
            color: #fff;
        }

        /* Search Button */
        .btn-search {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 16px;
            padding: 1rem 3rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            width: 100%;
            max-width: 300px;
            margin: 0 auto;
            display: block;
        }

        .btn-search:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .btn-search:active {
            transform: translateY(0);
        }

        .btn-search:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Loading State */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 2rem;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top-color: #fff;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Results Stats */
        .results-stats {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* Vehicle Grid */
        .vehicle-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }

        /* Vehicle Card */
        .vehicle-card {
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            overflow: hidden;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .vehicle-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .vehicle-image {
            width: 100%;
            height: 220px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            position: relative;
            overflow: hidden;
        }

        .vehicle-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .vehicle-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            padding: 0.5rem 1rem;
            border-radius: 12px;
            font-weight: 700;
            font-size: 1.125rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .vehicle-info {
            padding: 1.5rem;
        }

        .vehicle-title {
            font-size: 1.25rem;
            font-weight: 700;
            margin-bottom: 0.75rem;
            color: #fff;
        }

        .vehicle-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            opacity: 0.9;
        }

        .vehicle-source {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            font-size: 0.875rem;
            font-weight: 600;
            margin-top: 0.75rem;
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 2rem;
        }

        .modal-content {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.95) 0%, rgba(51, 65, 85, 0.95) 100%);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 24px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            color: #fff;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .modal-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .modal-image {
            width: 100%;
            height: 400px;
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.3) 0%, rgba(118, 75, 162, 0.3) 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 4rem;
            border-radius: 24px 24px 0 0;
        }

        .modal-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .modal-body {
            padding: 2rem;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 1rem;
        }

        .modal-price {
            font-size: 2.5rem;
            font-weight: 800;
            color: #10b981;
            margin-bottom: 1.5rem;
        }

        .modal-meta {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .modal-meta-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 1rem;
            border-radius: 12px;
        }

        .modal-meta-label {
            font-size: 0.875rem;
            opacity: 0.7;
            margin-bottom: 0.25rem;
        }

        .modal-meta-value {
            font-size: 1.25rem;
            font-weight: 700;
        }

        .btn-view-listing {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            border: none;
            border-radius: 16px;
            padding: 1rem 2rem;
            font-size: 1.125rem;
            font-weight: 700;
            color: #fff;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
        }

        .btn-view-listing:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(16, 185, 129, 0.3);
        }

        /* No Results */
        .no-results {
            text-align: center;
            padding: 4rem 2rem;
            background: var(--glass-bg);
            backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-radius: 24px;
        }

        .no-results-icon {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .no-results-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .no-results-subtext {
            opacity: 0.7;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .hero h1 {
                font-size: 2rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .vehicle-grid {
                grid-template-columns: 1fr;
            }

            .results-stats {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <div class="container" x-data="vehicleSearch()">
        <!-- Hero Section -->
        <div class="hero">
            <h1>üöó Milwaukee Vehicle Finder</h1>
            <p>Find your perfect car in Milwaukee - Real-time listings from Craigslist & more</p>
        </div>

        <!-- Search Panel -->
        <div class="search-panel">
            <form @submit.prevent="search()" class="form-grid">
                <div class="form-group">
                    <label for="make">Make</label>
                    <select id="make" x-model="searchParams.make" class="form-control">
                        <option value="">Any Make</option>
                        <option value="Honda">Honda</option>
                        <option value="Toyota">Toyota</option>
                        <option value="Ford">Ford</option>
                        <option value="Chevrolet">Chevrolet</option>
                        <option value="Nissan">Nissan</option>
                        <option value="Mazda">Mazda</option>
                        <option value="Hyundai">Hyundai</option>
                        <option value="Kia">Kia</option>
                        <option value="Subaru">Subaru</option>
                        <option value="Volkswagen">Volkswagen</option>
                        <option value="BMW">BMW</option>
                        <option value="Mercedes-Benz">Mercedes-Benz</option>
                        <option value="Audi">Audi</option>
                        <option value="Jeep">Jeep</option>
                        <option value="GMC">GMC</option>
                        <option value="Dodge">Dodge</option>
                        <option value="Ram">Ram</option>
                        <option value="Tesla">Tesla</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="model">Model</label>
                    <input type="text" id="model" x-model="searchParams.model" class="form-control" placeholder="e.g., Civic, Camry">
                </div>

                <div class="form-group">
                    <label for="min_year">Min Year</label>
                    <select id="min_year" x-model="searchParams.min_year" class="form-control">
                        <option value="">Any Year</option>
                        <template x-for="year in years" :key="year">
                            <option :value="year" x-text="year"></option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_year">Max Year</label>
                    <select id="max_year" x-model="searchParams.max_year" class="form-control">
                        <option value="">Any Year</option>
                        <template x-for="year in years" :key="year">
                            <option :value="year" x-text="year"></option>
                        </template>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_price">Max Price</label>
                    <select id="max_price" x-model="searchParams.max_price" class="form-control">
                        <option value="5000">$5,000</option>
                        <option value="10000">$10,000</option>
                        <option value="15000">$15,000</option>
                        <option value="20000">$20,000</option>
                        <option value="25000">$25,000</option>
                        <option value="30000">$30,000</option>
                        <option value="40000">$40,000</option>
                        <option value="50000">$50,000+</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="max_mileage">Max Mileage</label>
                    <select id="max_mileage" x-model="searchParams.max_mileage" class="form-control">
                        <option value="50000">50,000 mi</option>
                        <option value="75000">75,000 mi</option>
                        <option value="100000">100,000 mi</option>
                        <option value="150000">150,000 mi</option>
                        <option value="200000">200,000 mi</option>
                        <option value="300000">300,000+ mi</option>
                    </select>
                </div>
            </form>

            <button 
                type="button"
                @click="search()" 
                :disabled="loading" 
                class="btn-search"
            >
                <span x-show="!loading">üîç Search Vehicles</span>
                <span x-show="loading">Searching...</span>
            </button>
        </div>

        <!-- Loading State -->
        <div x-show="loading" class="loading">
            <div class="spinner"></div>
            <div>Searching listings...</div>
        </div>

        <!-- Results Stats -->
        <div x-show="!loading && results.length > 0" class="results-stats">
            <div class="stat-item">
                <div class="stat-label">Total Found</div>
                <div class="stat-value" x-text="results.length"></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Avg Price</div>
                <div class="stat-value" x-text="'$' + avgPrice.toLocaleString()"></div>
            </div>
            <div class="stat-item">
                <div class="stat-label">Best Deal</div>
                <div class="stat-value" x-text="'$' + (results[0]?.price || 0).toLocaleString()"></div>
            </div>
        </div>

        <!-- Vehicle Grid -->
        <div x-show="!loading && results.length > 0" class="vehicle-grid">
            <template x-for="vehicle in results" :key="vehicle.id">
                <div class="vehicle-card" @click="openModal(vehicle)">
                    <div class="vehicle-image">
                        <span style="opacity: 0.3;">üöó</span>
                        <div class="vehicle-badge" x-text="'$' + vehicle.price.toLocaleString()"></div>
                    </div>
                    <div class="vehicle-info">
                        <div class="vehicle-title" x-text="vehicle.title"></div>
                        <div class="vehicle-meta">
                            <div class="meta-item" x-show="vehicle.year">
                                <span>üìÖ</span>
                                <span x-text="vehicle.year"></span>
                            </div>
                            <div class="meta-item" x-show="vehicle.mileage">
                                <span>üõ£Ô∏è</span>
                                <span x-text="vehicle.mileage.toLocaleString() + ' mi'"></span>
                            </div>
                        </div>
                        <span class="vehicle-source" x-text="vehicle.source"></span>
                    </div>
                </div>
            </template>
        </div>

        <!-- No Results -->
        <div x-show="!loading && searched && results.length === 0" class="no-results">
            <div class="no-results-icon">üîç</div>
            <div class="no-results-text">No vehicles found</div>
            <div class="no-results-subtext">Try adjusting your search criteria</div>
        </div>

        <!-- Modal -->
        <div x-show="selectedVehicle" 
             @click.self="closeModal()" 
             class="modal-overlay"
             x-transition:enter="transition ease-out duration-300"
             x-transition:enter-start="opacity-0"
             x-transition:enter-end="opacity-100"
             x-transition:leave="transition ease-in duration-200"
             x-transition:leave-start="opacity-100"
             x-transition:leave-end="opacity-0">
            <div class="modal-content">
                <div class="modal-close" @click="closeModal()">‚úï</div>
                
                <div class="modal-image">
                    <span style="opacity: 0.3; font-size: 6rem;">üöó</span>
                </div>
                
                <div class="modal-body">
                    <h2 class="modal-title" x-text="selectedVehicle?.title"></h2>
                    <div class="modal-price" x-text="'$' + (selectedVehicle?.price || 0).toLocaleString()"></div>
                    
                    <div class="modal-meta">
                        <div class="modal-meta-item" x-show="selectedVehicle?.year">
                            <div class="modal-meta-label">Year</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.year"></div>
                        </div>
                        <div class="modal-meta-item" x-show="selectedVehicle?.mileage">
                            <div class="modal-meta-label">Mileage</div>
                            <div class="modal-meta-value" x-text="(selectedVehicle?.mileage || 0).toLocaleString() + ' mi'"></div>
                        </div>
                        <div class="modal-meta-item">
                            <div class="modal-meta-label">Source</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.source"></div>
                        </div>
                        <div class="modal-meta-item">
                            <div class="modal-meta-label">Location</div>
                            <div class="modal-meta-value" x-text="selectedVehicle?.location || 'Milwaukee'"></div>
                        </div>
                    </div>
                    
                    <button class="btn-view-listing" @click="window.open(selectedVehicle?.url, '_blank')">
                        View Full Listing ‚Üí
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        function vehicleSearch() {
            return {
                loading: false,
                searched: false,
                results: [],
                selectedVehicle: null,
                searchParams: {
                    make: 'Honda',
                    model: 'Civic',
                    min_year: '',
                    max_year: '',
                    max_price: 20000,
                    max_mileage: 150000
                },
                years: [],

                init() {
                    // Generate year options (current year down to 1990)
                    const currentYear = new Date().getFullYear();
                    for (let year = currentYear; year >= 1990; year--) {
                        this.years.push(year);
                    }
                    
                    // Automatically search with default values on load
                    this.search();
                },

                async search() {
                    this.loading = true;
                    this.searched = true;
                    this.results = [];

                    try {
                        const response = await fetch('/api/search', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                make: this.searchParams.make || undefined,
                                model: this.searchParams.model || undefined,
                                min_year: this.searchParams.min_year ? parseInt(this.searchParams.min_year) : undefined,
                                max_year: this.searchParams.max_year ? parseInt(this.searchParams.max_year) : undefined,
                                max_price: parseInt(this.searchParams.max_price),
                                max_mileage: parseInt(this.searchParams.max_mileage),
                                location: 'milwaukee'
                            })
                        });

                        const data = await response.json();
                        
                        if (data.success && data.vehicles) {
                            this.results = data.vehicles;
                            console.log(`Found ${this.results.length} vehicles`);
                        } else {
                            console.error('Search failed:', data);
                        }
                    } catch (error) {
                        console.error('Search error:', error);
                        alert('Search failed. Please try again.');
                    } finally {
                        this.loading = false;
                    }
                },

                get avgPrice() {
                    if (this.results.length === 0) return 0;
                    const sum = this.results.reduce((acc, v) => acc + (v.price || 0), 0);
                    return Math.round(sum / this.results.length);
                },

                openModal(vehicle) {
                    this.selectedVehicle = vehicle;
                    document.body.style.overflow = 'hidden';
                },

                closeModal() {
                    this.selectedVehicle = null;
                    document.body.style.overflow = 'auto';
                }
            }
        }
    </script>
</body>
</html>
